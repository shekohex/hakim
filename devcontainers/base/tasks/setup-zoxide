#!/bin/bash
#MISE description="Setup Zoxide"
#MISE depends=["setup-starship", "setup-direnv", "setup-atuin", "setup-blesh"]
set -euo pipefail

bashrc="/etc/bash.bashrc"
line='eval "$(/usr/local/bin/zoxide init bash)"'

tmp_file="$(mktemp)"
awk -v line="$line" '$0 != line { print }' "$bashrc" >"$tmp_file"
chown --reference="$bashrc" "$tmp_file" 2>/dev/null || true
chmod --reference="$bashrc" "$tmp_file" 2>/dev/null || chmod 644 "$tmp_file"
mv "$tmp_file" "$bashrc"

printf '%s\n' "$line" >> "$bashrc"
